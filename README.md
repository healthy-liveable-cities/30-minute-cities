   
# 30 minute cities code


This repository examines the spatial relationship between employment, the skills of residents, and transport opportunities, to answer three questions about Australiaâ€™s 21 largest cities: 1) What percentage of workers currently commute to their workplace within 30 minutes?; 2) If workers were to shift to an active transport mode, what percent could reach their current workplace with-in 30 minutes?; and 3) If it were possible to relocate workers closer to their employment or relocate employment closer to their home, what percentage could reach work within 30 minutes by each mode? 


## Steps to reproduce:

1. calculatePopulationCentroids.R - Creates the compound study regions, makes population-weighted centroids for the SA1 regions, and centroids for the DZN zones. These are all stored inside /data-output/30minuteCities.gpkg
2. filterRoadNetwork.sh - Needs to be run manually for now (i.e., paste the code interactively in the shell). It filters the osm data to just the road network.
3. snapCentroidsToRoads.R - Takes in the road networks and snaps the centroids to them. These are then saved within the /data-output/OD_coordinates directory in a format suitable for Carl's openTripPlanner code.
4. [30_min_cities_analysis_region_loop.sh](https://github.com/healthy-liveable-cities/otp-multimodal-access-analysis/blob/master/30_min_cities_analysis_region_loop.sh) - This file loops over each capital city, running the 30-min-cities shell script run-otp.sh a wrapper function for OpenTripPlanner Jython code based on Dhirendra Singh's LATCH-ABM project, which was generalised and applied specifically for the 30 minute cities project by the researchers. This estimates time to travel between population weighted SA1 (2016) centroids to DZN centroids using a combination of OpenStreetMap and General Transit Feed Specification (GTFS) data.  GTFS data were sourced for each Australian state transit agency in September 2019, with general coverage range of October to December 2019.  Analyses were conducted with a departure time of 07:45, and 10:45, to a maximum travel time of 3 hours and maximum walk distance of 100 km.  Modes considered were walking, cycling, driving, and a combination of walking and public transport.  Only the public transport mode takes into account the difference in peak hour analysis, hence the analysis at 10.45 was only run for this mode.   The model does not account for peak hour congestion other than with regard to public transport scheduling; this is a source of bias in estimates for car travel time in particular, and which shall be discussed in the limitations section.  Results are stored in the form of sqlite databases, recording origin, destination, departure time, mode, total distance walked and duration for each origin-destination combination, representing estimates for the shortest trip possible using that mode. These are stored along with input, intermediary graph object, and metadata files, in city specific output folders within the /data-output/graphs directory.  The code for this step is located at https://github.com/healthy-liveable-cities/otp-multimodal-access-analysis.
5. formatSqlite.sh - sqlite code for formatting Carl's data, expects input in /data-output/graphs and places formatted outputs in same directory
6. calculateFlows.R - takes the formatted outputs from step 5 and converts them into cost matrices. Imports census data on the number of jobs for each job type in SA1 and DZNs to calculate an optimised flow model of what DZN people should choose for their work.
7. calculateVISTAtimes.R - finds the average speed of VISTA survey participants for the journeys to work by mode.
8. analyseResults.R - takes the optimised flow model and compares it with the percentage of people who actually reach their job within 30 minutes.